volumes:
  caddy_data:
  caddy_config:
  ntfy_config:
  ntfy_cache:
  lldap_data:
  heimdall_config:
  heimdall_config2:
  adguard_config:

services:
  caddy:
    image: caddy:2.8.4
    restart: unless-stopped
    environment:
      DOMAIN: ${DOMAIN}
    ports:
      - 80:80
      - 443:443
    volumes:
      - caddy_data:/data
      - caddy_config:/config
      - ./Caddyfile:/etc/caddy/Caddyfile

  authelia:
    image: authelia/authelia:4.38.16
    restart: unless-stopped
    ports:
      - 127.0.0.1:9091:9091
    environment:
      PUID: 1001
      PGID: 1001
      X_AUTHELIA_CONFIG_FILTERS: expand-env,template
      AUTHELIA_IDENTITY_VALIDATION_RESET_PASSWORD_JWT_SECRET_FILE: '/secrets/JWT_SECRET'
      AUTHELIA_SESSION_SECRET_FILE: '/secrets/SESSION_SECRET'
      AUTHELIA_STORAGE_ENCRYPTION_KEY_FILE: '/secrets/STORAGE_ENCRYPTION_KEY'
      AUTHELIA_AUTHENTICATION_BACKEND_LDAP_PASSWORD_FILE: '/secrets/LDAP_PASSWORD'
      # Custom env vars
      LDAP_BASE_DN: ${LDAP_BASE_DN}
      DOMAIN: ${DOMAIN}
    volumes:
      - ./authelia/config:/config
      - ./authelia/secrets:/secrets

  lldap:
    image: lldap/lldap:2024-10-10-alpine
    restart: unless-stopped
    ports:
      - 127.0.0.1:17170:17170
      - 6360:6360
    environment:
      UID: 1001
      GID: 1001
      TZ: Europe/Amsterdam
      LLDAP_JWT_SECRET_FILE: /secrets/JWT_SECRET
      LLDAP_LDAP_USER_PASS_FILE: /secrets/ADMIN_PASS
      LLDAP_KEY_SEED: Kn3NErqOdOvaKHgBrtp8
      LLDAP_LDAP_BASE_DN: ${LDAP_BASE_DN}
      LLDAP_LDAPS_OPTIONS__ENABLED: true
      LLDAP_LDAPS_OPTIONS__CERT_FILE: /secrets/certificate.crt
      LLDAP_LDAPS_OPTIONS__KEY_FILE: /secrets/private.key
    volumes:
      - lldap_data:/data
      - ./lldap_config:/secrets

  # gatus:
  #   image: twinproduction/gatus:v5.12.1
  #   restart: unless-stopped
  #   ports:
  #     - 127.0.0.1:8080:8080
  #   volumes:
  #     - ./gatus/config:/config

  # ntfy:
  #   image: binwiederhier/ntfy
  #   restart: unless-stopped
  #   command:
  #     - serve
  #   ports:
  #     - 22500:25
  #   # - 127.0.0.1:8888:80
  #   environment:
  #     TZ: Europe/Amsterdam    # optional: set desired timezone
  #   volumes:
  #     - ntfy_cache:/var/cache/ntfy
  #     - ntfy_config:/etc/ntfy
  #     - ./ntfy-server.yml:/etc/ntfy/server.yml

  frps:
    image: snowdreamtech/frps:0.57.0
    restart: unless-stopped
    ports:
      - 7070:7070 # FRP bindport
      - 127.0.0.1:6789:6789 # FRP vhost port
      # - 127.0.0.1:7500:7500 # FRP dashboard
    volumes:
      - ./frps.toml:/etc/frp/frps.toml
    env_file: frps.env

  heimdall:
    image: lscr.io/linuxserver/heimdall:latest
    environment:
      TZ: Europe/Amsterdam
    volumes:
      - heimdall_config:/config
    # ports:
    #   - 127.0.0.1:8088:80
    restart: unless-stopped

  heimdall2:
    image: lscr.io/linuxserver/heimdall:latest
    environment:
      TZ: Europe/Amsterdam
    volumes:
      - heimdall_config2:/config
    # ports:
    #   - 127.0.0.1:8088:80
    restart: unless-stopped

  radicale:
    image: trxd/radicale:3.2.3
    # ports: 
    #   - "127.0.0.1:5232:5232"
    volumes: 
      - ./radicale-data:/var/radicale
      - ./radicale.config.ini:/var/radicale/config.ini
    restart: unless-stopped

  joplin:
    image: joplin/server:latest
    # ports:
    #   - "22300:22300"
    restart: unless-stopped
    environment:
      APP_PORT: 22300
      APP_BASE_URL: http://joplin.${DOMAIN}

  adguard:
    image: adguard/adguardhome
    ports:
      - 53:53/tcp
      - 53:53/udp
      # - 80:80/tcp
      # - 443:443/tcp
      # - 3000:3000/tcp
    restart: unless-stopped
